/raid/chrisjihee/miniforge3/envs/DeepKNLP/bin/python /raid/chrisjihee/proj/DeepKNLP/task2-nerG.py train
[2024-12-18 15:54:53,368] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
initializing deepspeed distributed: GLOBAL_RANK: 0, MEMBER: 1/8
[2024-12-18 15:55:06,993] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-12-18 15:55:06,997] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-12-18 15:55:07,002] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-12-18 15:55:07,005] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-12-18 15:55:07,008] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-12-18 15:55:07,010] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-12-18 15:55:07,012] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
initializing deepspeed distributed: GLOBAL_RANK: 7, MEMBER: 8/8
initializing deepspeed distributed: GLOBAL_RANK: 3, MEMBER: 4/8
initializing deepspeed distributed: GLOBAL_RANK: 1, MEMBER: 2/8
initializing deepspeed distributed: GLOBAL_RANK: 4, MEMBER: 5/8
initializing deepspeed distributed: GLOBAL_RANK: 6, MEMBER: 7/8
initializing deepspeed distributed: GLOBAL_RANK: 5, MEMBER: 6/8
initializing deepspeed distributed: GLOBAL_RANK: 2, MEMBER: 3/8
Enabling DeepSpeed BF16. Model parameters and inputs will be cast to `bfloat16`.
[12.18 15:55:27] ┇ INFO     ┇       chrisbase.data ┇ =========================================================================================================================================
[12.18 15:55:27] ┇ INFO     ┇       chrisbase.data ┇ [INIT] python /raid/chrisjihee/proj/DeepKNLP/DeepKNLP/arguments.py train
[12.18 15:55:27] ┇ INFO     ┇       chrisbase.data ┇ =========================================================================================================================================
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇ -----+-----------------------------+--------------------------------------------------------------
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇    # | TrainingArguments           | value
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇ -----+-----------------------------+--------------------------------------------------------------
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇    1 | env.hostname                | dgx-a100
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇    2 | env.hostaddr                | 129.254.23.12
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇    3 | env.global_rank             | 0
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇    4 | env.local_rank              | 0
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇    5 | env.node_rank               | 0
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇    6 | env.world_size              | 8
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇    7 | env.time_stamp              | 1218.155452
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇    8 | env.python_path             | /raid/chrisjihee/miniforge3/envs/DeepKNLP/bin/python
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇    9 | env.current_dir             | /raid/chrisjihee/proj/DeepKNLP
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   10 | env.current_file            | /raid/chrisjihee/proj/DeepKNLP/DeepKNLP/arguments.py
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   11 | env.command_args            | ['train']
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   12 | env.logging_home            | /raid/chrisjihee/proj/DeepKNLP/output/GNER/version_14
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   13 | env.logging_file            | train-messages.out
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   14 | env.argument_file           | train-arguments.json
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   15 | env.random_seed             | 7
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   16 | env.max_workers             | 4
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   17 | env.debugging               | False
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   18 | env.date_format             | [%m.%d %H:%M:%S]
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   19 | env.message_level           | 20
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   20 | env.message_format          | %(asctime)s ┇ %(levelname)-8s ┇ %(name)20s ┇ %(message)s
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   21 | time.t1                     | 2024-12-18 15:55:27.986555
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   22 | time.t2                     | 2024-12-18 15:54:52.971720
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   23 | time.started                | [12.18 15:55:27]
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   24 | time.settled                |
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   25 | time.elapsed                |
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   26 | input.pretrained            | /raid/chrisjihee/proj/DeepKNLP/meta-llama/Llama-3.1-8B
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   27 | input.train_file            | /raid/chrisjihee/proj/DeepKNLP/data/gner/pile-ner.jsonl
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   28 | input.study_file            |
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   29 | input.eval_file             | /raid/chrisjihee/proj/DeepKNLP/data/gner/zero-shot-dev.jsonl
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   30 | input.test_file             |
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   31 | input.max_train_samples     | -1
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   32 | input.max_study_samples     | -1
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   33 | input.max_eval_samples      | -1
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   34 | input.max_test_samples      | -1
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   35 | input.max_source_length     | 640
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   36 | input.max_target_length     | 640
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   37 | input.max_generation_length | 1280
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   38 | input.use_cache_data        | True
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   39 | learn.output_home           | /raid/chrisjihee/proj/DeepKNLP/output
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   40 | learn.output_name           | GNER
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   41 | learn.run_version           |
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   42 | learn.num_train_epochs      | 3
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   43 | learn.learning_rate         | 2e-05
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   44 | learn.weight_decay          | 0.0
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   45 | learn.train_batch           | 1
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   46 | learn.infer_batch           | 10
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   47 | learn.grad_steps            | 20
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   48 | learn.eval_steps            | 40
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   49 | learn.num_device            | 8
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   50 | learn.device_idx            | 0
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   51 | learn.device_type           | gpu
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   52 | learn.precision             | bf16-mixed
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   53 | learn.strategy              | deepspeed
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   54 | learn.ds_stage              | 3
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   55 | learn.ds_offload            | 3
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   56 | learn.fsdp_shard            | FULL_SHARD
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   57 | learn.fsdp_offload          | False
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇   58 | learn.devices               | 8
[12.18 15:55:27] ┇ INFO     ┇   DeepKNLP.arguments ┇ -----+-----------------------------+--------------------------------------------------------------
[12.18 15:55:28] ┇ INFO     ┇ transformers.tokenization_utils_base ┇ loading file tokenizer.json from cache at /raid/chrisjihee/.cache/huggingface/hub/models--meta-llama--Llama-3.1-8B/snapshots/d04e592bb4f6aa9cfee91e2e20afa771667e1d4b/tokenizer.json
[12.18 15:55:28] ┇ INFO     ┇ transformers.tokenization_utils_base ┇ loading file tokenizer.model from cache at None
[12.18 15:55:28] ┇ INFO     ┇ transformers.tokenization_utils_base ┇ loading file added_tokens.json from cache at None
[12.18 15:55:28] ┇ INFO     ┇ transformers.tokenization_utils_base ┇ loading file special_tokens_map.json from cache at /raid/chrisjihee/.cache/huggingface/hub/models--meta-llama--Llama-3.1-8B/snapshots/d04e592bb4f6aa9cfee91e2e20afa771667e1d4b/special_tokens_map.json
[12.18 15:55:28] ┇ INFO     ┇ transformers.tokenization_utils_base ┇ loading file tokenizer_config.json from cache at /raid/chrisjihee/.cache/huggingface/hub/models--meta-llama--Llama-3.1-8B/snapshots/d04e592bb4f6aa9cfee91e2e20afa771667e1d4b/tokenizer_config.json
[12.18 15:55:28] ┇ INFO     ┇ transformers.tokenization_utils_base ┇ loading file chat_template.jinja from cache at None
[12.18 15:55:28] ┇ INFO     ┇ transformers.tokenization_utils_base ┇ Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
[12.18 15:55:28] ┇ INFO     ┇ transformers.modeling_utils ┇ loading weights file model.safetensors from cache at /raid/chrisjihee/.cache/huggingface/hub/models--meta-llama--Llama-3.1-8B/snapshots/d04e592bb4f6aa9cfee91e2e20afa771667e1d4b/model.safetensors.index.json
Loading checkpoint shards: 100%|██████████| 4/4 [00:03<00:00,  1.26it/s]
[12.18 15:55:32] ┇ INFO     ┇ transformers.modeling_utils ┇ All model checkpoint weights were used when initializing LlamaForCausalLM.

[12.18 15:55:32] ┇ INFO     ┇ transformers.modeling_utils ┇ All the weights of LlamaForCausalLM were initialized from the model checkpoint at meta-llama/Llama-3.1-8B.
If your task is similar to the task the model of the checkpoint was trained on, you can already use LlamaForCausalLM for predictions without further training.
Loading checkpoint shards: 100%|██████████| 4/4 [00:05<00:00,  1.35s/it]
Loading checkpoint shards: 100%|██████████| 4/4 [00:05<00:00,  1.42s/it]
Loading checkpoint shards: 100%|██████████| 4/4 [00:05<00:00,  1.43s/it]
Loading checkpoint shards: 100%|██████████| 4/4 [00:05<00:00,  1.45s/it]
Loading checkpoint shards: 100%|██████████| 4/4 [00:05<00:00,  1.48s/it]
Loading checkpoint shards: 100%|██████████| 4/4 [00:06<00:00,  1.57s/it]
Loading checkpoint shards: 100%|██████████| 4/4 [00:06<00:00,  1.59s/it]
[12.18 15:55:39] ┇ INFO     ┇             __main__ ┇ Load train dataset from /raid/chrisjihee/proj/DeepKNLP/data/gner/pile-ner.jsonl => 105,659
[12.18 15:55:40] ┇ INFO     ┇             __main__ ┇ Load  eval dataset from /raid/chrisjihee/proj/DeepKNLP/data/gner/zero-shot-dev.jsonl => 6,085
[12.18 15:55:41] ┇ INFO     ┇             __main__ ┇ ----------------------------------------------------------------------------------------------------
[12.18 15:55:42] ┇ INFO     ┇             __main__ ┇ ----------------------------------------------------------------------------------------------------
[12.18 15:56:43] ┇ INFO     ┇       chrisbase.data ┇ =========================================================================================================================================
[12.18 15:56:43] ┇ INFO     ┇       chrisbase.data ┇ [EXIT] python /raid/chrisjihee/proj/DeepKNLP/DeepKNLP/arguments.py train ($=00:01:15.086)
[12.18 15:56:43] ┇ INFO     ┇       chrisbase.data ┇ =========================================================================================================================================
[rank7]: Traceback (most recent call last):
[rank7]:   File "/raid/chrisjihee/proj/DeepKNLP/task2-nerG.py", line 822, in <module>
[rank7]:     app()
[rank7]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 340, in __call__
[rank7]:     raise e
[rank7]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 323, in __call__
[rank7]:     return get_command(self)(*args, **kwargs)
[rank7]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank7]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1157, in __call__
[rank7]:     return self.main(*args, **kwargs)
[rank7]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank7]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/core.py", line 743, in main
[rank7]:     return _main(
[rank7]:            ^^^^^^
[rank7]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/core.py", line 198, in _main
[rank7]:     rv = self.invoke(ctx)
[rank7]:          ^^^^^^^^^^^^^^^^
[rank7]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1688, in invoke
[rank7]:     return _process_result(sub_ctx.command.invoke(sub_ctx))
[rank7]:                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank7]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1434, in invoke
[rank7]:     return ctx.invoke(self.callback, **ctx.params)
[rank7]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank7]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 783, in invoke
[rank7]:     return __callback(*args, **kwargs)
[rank7]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank7]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 698, in wrapper
[rank7]:     return callback(**use_params)
[rank7]:            ^^^^^^^^^^^^^^^^^^^^^^
[rank7]:   File "/raid/chrisjihee/proj/DeepKNLP/task2-nerG.py", line 619, in train
[rank7]:     model_optimizer = fabric.setup(model, optimizer)
[rank7]:                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank7]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/fabric.py", line 245, in setup
[rank7]:     module, optimizers = self._strategy.setup_module_and_optimizers(  # type: ignore[assignment]
[rank7]:                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank7]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/strategies/deepspeed.py", line 331, in setup_module_and_optimizers
[rank7]:     self._deepspeed_engine, optimizer = self._initialize_engine(module, optimizers[0])
[rank7]:                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank7]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/strategies/deepspeed.py", line 607, in _initialize_engine
[rank7]:     deepspeed_engine, deepspeed_optimizer, _, _ = deepspeed.initialize(
[rank7]:                                                   ^^^^^^^^^^^^^^^^^^^^^
[rank7]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/__init__.py", line 193, in initialize
[rank7]:     engine = DeepSpeedEngine(args=args,
[rank7]:              ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank7]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/runtime/engine.py", line 315, in __init__
[rank7]:     self._configure_optimizer(optimizer, model_parameters)
[rank7]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/runtime/engine.py", line 1297, in _configure_optimizer
[rank7]:     raise ZeRORuntimeException(msg)
[rank7]: deepspeed.runtime.zero.utils.ZeRORuntimeException: You are using ZeRO-Offload with a client provided optimizer (<class 'torch.optim.adamw.AdamW'>) which in most cases will yield poor performance. Please either use deepspeed.ops.adam.DeepSpeedCPUAdam or set an optimizer in your ds-config (https://www.deepspeed.ai/docs/config-json/#optimizer-parameters). If you really want to use a custom optimizer w. ZeRO-Offload and understand the performance impacts you can also set <"zero_force_ds_cpu_optimizer": false> in your configuration file.
[rank6]: Traceback (most recent call last):
[rank6]:   File "/raid/chrisjihee/proj/DeepKNLP/task2-nerG.py", line 822, in <module>
[rank6]:     app()
[rank6]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 340, in __call__
[rank6]:     raise e
[rank6]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 323, in __call__
[rank6]:     return get_command(self)(*args, **kwargs)
[rank6]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1157, in __call__
[rank6]:     return self.main(*args, **kwargs)
[rank6]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/core.py", line 743, in main
[rank6]:     return _main(
[rank6]:            ^^^^^^
[rank6]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/core.py", line 198, in _main
[rank6]:     rv = self.invoke(ctx)
[rank6]:          ^^^^^^^^^^^^^^^^
[rank6]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1688, in invoke
[rank6]:     return _process_result(sub_ctx.command.invoke(sub_ctx))
[rank6]:                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1434, in invoke
[rank6]:     return ctx.invoke(self.callback, **ctx.params)
[rank6]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 783, in invoke
[rank6]:     return __callback(*args, **kwargs)
[rank6]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 698, in wrapper
[rank6]:     return callback(**use_params)
[rank6]:            ^^^^^^^^^^^^^^^^^^^^^^
[rank6]:   File "/raid/chrisjihee/proj/DeepKNLP/task2-nerG.py", line 619, in train
[rank6]:     model_optimizer = fabric.setup(model, optimizer)
[rank6]:                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/fabric.py", line 245, in setup
[rank6]:     module, optimizers = self._strategy.setup_module_and_optimizers(  # type: ignore[assignment]
[rank6]:                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/strategies/deepspeed.py", line 331, in setup_module_and_optimizers
[rank6]:     self._deepspeed_engine, optimizer = self._initialize_engine(module, optimizers[0])
[rank6]:                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/strategies/deepspeed.py", line 607, in _initialize_engine
[rank6]:     deepspeed_engine, deepspeed_optimizer, _, _ = deepspeed.initialize(
[rank6]:                                                   ^^^^^^^^^^^^^^^^^^^^^
[rank6]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/__init__.py", line 193, in initialize
[rank6]:     engine = DeepSpeedEngine(args=args,
[rank6]:              ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank6]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/runtime/engine.py", line 315, in __init__
[rank6]:     self._configure_optimizer(optimizer, model_parameters)
[rank6]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/runtime/engine.py", line 1297, in _configure_optimizer
[rank6]:     raise ZeRORuntimeException(msg)
[rank6]: deepspeed.runtime.zero.utils.ZeRORuntimeException: You are using ZeRO-Offload with a client provided optimizer (<class 'torch.optim.adamw.AdamW'>) which in most cases will yield poor performance. Please either use deepspeed.ops.adam.DeepSpeedCPUAdam or set an optimizer in your ds-config (https://www.deepspeed.ai/docs/config-json/#optimizer-parameters). If you really want to use a custom optimizer w. ZeRO-Offload and understand the performance impacts you can also set <"zero_force_ds_cpu_optimizer": false> in your configuration file.
[rank2]: Traceback (most recent call last):
[rank2]:   File "/raid/chrisjihee/proj/DeepKNLP/task2-nerG.py", line 822, in <module>
[rank2]:     app()
[rank2]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 340, in __call__
[rank2]:     raise e
[rank2]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 323, in __call__
[rank2]:     return get_command(self)(*args, **kwargs)
[rank2]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1157, in __call__
[rank2]:     return self.main(*args, **kwargs)
[rank2]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/core.py", line 743, in main
[rank2]:     return _main(
[rank2]:            ^^^^^^
[rank2]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/core.py", line 198, in _main
[rank2]:     rv = self.invoke(ctx)
[rank2]:          ^^^^^^^^^^^^^^^^
[rank2]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1688, in invoke
[rank2]:     return _process_result(sub_ctx.command.invoke(sub_ctx))
[rank2]:                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1434, in invoke
[rank2]:     return ctx.invoke(self.callback, **ctx.params)
[rank2]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 783, in invoke
[rank2]:     return __callback(*args, **kwargs)
[rank2]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 698, in wrapper
[rank2]:     return callback(**use_params)
[rank2]:            ^^^^^^^^^^^^^^^^^^^^^^
[rank2]:   File "/raid/chrisjihee/proj/DeepKNLP/task2-nerG.py", line 619, in train
[rank2]:     model_optimizer = fabric.setup(model, optimizer)
[rank2]:                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/fabric.py", line 245, in setup
[rank2]:     module, optimizers = self._strategy.setup_module_and_optimizers(  # type: ignore[assignment]
[rank2]:                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/strategies/deepspeed.py", line 331, in setup_module_and_optimizers
[rank2]:     self._deepspeed_engine, optimizer = self._initialize_engine(module, optimizers[0])
[rank2]:                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/strategies/deepspeed.py", line 607, in _initialize_engine
[rank2]:     deepspeed_engine, deepspeed_optimizer, _, _ = deepspeed.initialize(
[rank2]:                                                   ^^^^^^^^^^^^^^^^^^^^^
[rank2]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/__init__.py", line 193, in initialize
[rank2]:     engine = DeepSpeedEngine(args=args,
[rank2]:              ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank2]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/runtime/engine.py", line 315, in __init__
[rank2]:     self._configure_optimizer(optimizer, model_parameters)
[rank2]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/runtime/engine.py", line 1297, in _configure_optimizer
[rank2]:     raise ZeRORuntimeException(msg)
[rank2]: deepspeed.runtime.zero.utils.ZeRORuntimeException: You are using ZeRO-Offload with a client provided optimizer (<class 'torch.optim.adamw.AdamW'>) which in most cases will yield poor performance. Please either use deepspeed.ops.adam.DeepSpeedCPUAdam or set an optimizer in your ds-config (https://www.deepspeed.ai/docs/config-json/#optimizer-parameters). If you really want to use a custom optimizer w. ZeRO-Offload and understand the performance impacts you can also set <"zero_force_ds_cpu_optimizer": false> in your configuration file.
[rank3]: Traceback (most recent call last):
[rank3]:   File "/raid/chrisjihee/proj/DeepKNLP/task2-nerG.py", line 822, in <module>
[rank3]:     app()
[rank3]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 340, in __call__
[rank3]:     raise e
[rank3]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 323, in __call__
[rank3]:     return get_command(self)(*args, **kwargs)
[rank3]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1157, in __call__
[rank3]:     return self.main(*args, **kwargs)
[rank3]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/core.py", line 743, in main
[rank3]:     return _main(
[rank3]:            ^^^^^^
[rank3]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/core.py", line 198, in _main
[rank3]:     rv = self.invoke(ctx)
[rank3]:          ^^^^^^^^^^^^^^^^
[rank3]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1688, in invoke
[rank3]:     return _process_result(sub_ctx.command.invoke(sub_ctx))
[rank3]:                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1434, in invoke
[rank3]:     return ctx.invoke(self.callback, **ctx.params)
[rank3]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 783, in invoke
[rank3]:     return __callback(*args, **kwargs)
[rank3]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 698, in wrapper
[rank3]:     return callback(**use_params)
[rank3]:            ^^^^^^^^^^^^^^^^^^^^^^
[rank3]:   File "/raid/chrisjihee/proj/DeepKNLP/task2-nerG.py", line 619, in train
[rank3]:     model_optimizer = fabric.setup(model, optimizer)
[rank3]:                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/fabric.py", line 245, in setup
[rank3]:     module, optimizers = self._strategy.setup_module_and_optimizers(  # type: ignore[assignment]
[rank3]:                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/strategies/deepspeed.py", line 331, in setup_module_and_optimizers
[rank3]:     self._deepspeed_engine, optimizer = self._initialize_engine(module, optimizers[0])
[rank3]:                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/strategies/deepspeed.py", line 607, in _initialize_engine
[rank3]:     deepspeed_engine, deepspeed_optimizer, _, _ = deepspeed.initialize(
[rank3]:                                                   ^^^^^^^^^^^^^^^^^^^^^
[rank3]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/__init__.py", line 193, in initialize
[rank3]:     engine = DeepSpeedEngine(args=args,
[rank3]:              ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank3]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/runtime/engine.py", line 315, in __init__
[rank3]:     self._configure_optimizer(optimizer, model_parameters)
[rank3]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/runtime/engine.py", line 1297, in _configure_optimizer
[rank3]:     raise ZeRORuntimeException(msg)
[rank3]: deepspeed.runtime.zero.utils.ZeRORuntimeException: You are using ZeRO-Offload with a client provided optimizer (<class 'torch.optim.adamw.AdamW'>) which in most cases will yield poor performance. Please either use deepspeed.ops.adam.DeepSpeedCPUAdam or set an optimizer in your ds-config (https://www.deepspeed.ai/docs/config-json/#optimizer-parameters). If you really want to use a custom optimizer w. ZeRO-Offload and understand the performance impacts you can also set <"zero_force_ds_cpu_optimizer": false> in your configuration file.
[rank4]: Traceback (most recent call last):
[rank4]:   File "/raid/chrisjihee/proj/DeepKNLP/task2-nerG.py", line 822, in <module>
[rank4]:     app()
[rank4]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 340, in __call__
[rank4]:     raise e
[rank4]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 323, in __call__
[rank4]:     return get_command(self)(*args, **kwargs)
[rank4]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank4]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1157, in __call__
[rank4]:     return self.main(*args, **kwargs)
[rank4]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank4]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/core.py", line 743, in main
[rank4]:     return _main(
[rank4]:            ^^^^^^
[rank4]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/core.py", line 198, in _main
[rank4]:     rv = self.invoke(ctx)
[rank4]:          ^^^^^^^^^^^^^^^^
[rank4]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1688, in invoke
[rank4]:     return _process_result(sub_ctx.command.invoke(sub_ctx))
[rank4]:                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank4]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1434, in invoke
[rank4]:     return ctx.invoke(self.callback, **ctx.params)
[rank4]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank4]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 783, in invoke
[rank4]:     return __callback(*args, **kwargs)
[rank4]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank4]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 698, in wrapper
[rank4]:     return callback(**use_params)
[rank4]:            ^^^^^^^^^^^^^^^^^^^^^^
[rank4]:   File "/raid/chrisjihee/proj/DeepKNLP/task2-nerG.py", line 619, in train
[rank4]:     model_optimizer = fabric.setup(model, optimizer)
[rank4]:                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank4]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/fabric.py", line 245, in setup
[rank4]:     module, optimizers = self._strategy.setup_module_and_optimizers(  # type: ignore[assignment]
[rank4]:                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank4]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/strategies/deepspeed.py", line 331, in setup_module_and_optimizers
[rank4]:     self._deepspeed_engine, optimizer = self._initialize_engine(module, optimizers[0])
[rank4]:                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank4]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/strategies/deepspeed.py", line 607, in _initialize_engine
[rank4]:     deepspeed_engine, deepspeed_optimizer, _, _ = deepspeed.initialize(
[rank4]:                                                   ^^^^^^^^^^^^^^^^^^^^^
[rank4]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/__init__.py", line 193, in initialize
[rank4]:     engine = DeepSpeedEngine(args=args,
[rank4]:              ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank4]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/runtime/engine.py", line 315, in __init__
[rank4]:     self._configure_optimizer(optimizer, model_parameters)
[rank4]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/runtime/engine.py", line 1297, in _configure_optimizer
[rank4]:     raise ZeRORuntimeException(msg)
[rank4]: deepspeed.runtime.zero.utils.ZeRORuntimeException: You are using ZeRO-Offload with a client provided optimizer (<class 'torch.optim.adamw.AdamW'>) which in most cases will yield poor performance. Please either use deepspeed.ops.adam.DeepSpeedCPUAdam or set an optimizer in your ds-config (https://www.deepspeed.ai/docs/config-json/#optimizer-parameters). If you really want to use a custom optimizer w. ZeRO-Offload and understand the performance impacts you can also set <"zero_force_ds_cpu_optimizer": false> in your configuration file.
[rank1]: Traceback (most recent call last):
[rank1]:   File "/raid/chrisjihee/proj/DeepKNLP/task2-nerG.py", line 822, in <module>
[rank1]:     app()
[rank1]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 340, in __call__
[rank1]:     raise e
[rank1]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 323, in __call__
[rank1]:     return get_command(self)(*args, **kwargs)
[rank1]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1157, in __call__
[rank1]:     return self.main(*args, **kwargs)
[rank1]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/core.py", line 743, in main
[rank1]:     return _main(
[rank1]:            ^^^^^^
[rank1]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/core.py", line 198, in _main
[rank1]:     rv = self.invoke(ctx)
[rank1]:          ^^^^^^^^^^^^^^^^
[rank1]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1688, in invoke
[rank1]:     return _process_result(sub_ctx.command.invoke(sub_ctx))
[rank1]:                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1434, in invoke
[rank1]:     return ctx.invoke(self.callback, **ctx.params)
[rank1]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 783, in invoke
[rank1]:     return __callback(*args, **kwargs)
[rank1]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 698, in wrapper
[rank1]:     return callback(**use_params)
[rank1]:            ^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/raid/chrisjihee/proj/DeepKNLP/task2-nerG.py", line 619, in train
[rank1]:     model_optimizer = fabric.setup(model, optimizer)
[rank1]:                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/fabric.py", line 245, in setup
[rank1]:     module, optimizers = self._strategy.setup_module_and_optimizers(  # type: ignore[assignment]
[rank1]:                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/strategies/deepspeed.py", line 331, in setup_module_and_optimizers
[rank1]:     self._deepspeed_engine, optimizer = self._initialize_engine(module, optimizers[0])
[rank1]:                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/strategies/deepspeed.py", line 607, in _initialize_engine
[rank1]:     deepspeed_engine, deepspeed_optimizer, _, _ = deepspeed.initialize(
[rank1]:                                                   ^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/__init__.py", line 193, in initialize
[rank1]:     engine = DeepSpeedEngine(args=args,
[rank1]:              ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank1]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/runtime/engine.py", line 315, in __init__
[rank1]:     self._configure_optimizer(optimizer, model_parameters)
[rank1]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/runtime/engine.py", line 1297, in _configure_optimizer
[rank1]:     raise ZeRORuntimeException(msg)
[rank1]: deepspeed.runtime.zero.utils.ZeRORuntimeException: You are using ZeRO-Offload with a client provided optimizer (<class 'torch.optim.adamw.AdamW'>) which in most cases will yield poor performance. Please either use deepspeed.ops.adam.DeepSpeedCPUAdam or set an optimizer in your ds-config (https://www.deepspeed.ai/docs/config-json/#optimizer-parameters). If you really want to use a custom optimizer w. ZeRO-Offload and understand the performance impacts you can also set <"zero_force_ds_cpu_optimizer": false> in your configuration file.
[rank5]: Traceback (most recent call last):
[rank5]:   File "/raid/chrisjihee/proj/DeepKNLP/task2-nerG.py", line 822, in <module>
[rank5]:     app()
[rank5]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 340, in __call__
[rank5]:     raise e
[rank5]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 323, in __call__
[rank5]:     return get_command(self)(*args, **kwargs)
[rank5]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank5]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1157, in __call__
[rank5]:     return self.main(*args, **kwargs)
[rank5]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank5]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/core.py", line 743, in main
[rank5]:     return _main(
[rank5]:            ^^^^^^
[rank5]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/core.py", line 198, in _main
[rank5]:     rv = self.invoke(ctx)
[rank5]:          ^^^^^^^^^^^^^^^^
[rank5]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1688, in invoke
[rank5]:     return _process_result(sub_ctx.command.invoke(sub_ctx))
[rank5]:                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank5]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1434, in invoke
[rank5]:     return ctx.invoke(self.callback, **ctx.params)
[rank5]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank5]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 783, in invoke
[rank5]:     return __callback(*args, **kwargs)
[rank5]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank5]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 698, in wrapper
[rank5]:     return callback(**use_params)
[rank5]:            ^^^^^^^^^^^^^^^^^^^^^^
[rank5]:   File "/raid/chrisjihee/proj/DeepKNLP/task2-nerG.py", line 619, in train
[rank5]:     model_optimizer = fabric.setup(model, optimizer)
[rank5]:                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank5]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/fabric.py", line 245, in setup
[rank5]:     module, optimizers = self._strategy.setup_module_and_optimizers(  # type: ignore[assignment]
[rank5]:                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank5]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/strategies/deepspeed.py", line 331, in setup_module_and_optimizers
[rank5]:     self._deepspeed_engine, optimizer = self._initialize_engine(module, optimizers[0])
[rank5]:                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank5]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/strategies/deepspeed.py", line 607, in _initialize_engine
[rank5]:     deepspeed_engine, deepspeed_optimizer, _, _ = deepspeed.initialize(
[rank5]:                                                   ^^^^^^^^^^^^^^^^^^^^^
[rank5]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/__init__.py", line 193, in initialize
[rank5]:     engine = DeepSpeedEngine(args=args,
[rank5]:              ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank5]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/runtime/engine.py", line 315, in __init__
[rank5]:     self._configure_optimizer(optimizer, model_parameters)
[rank5]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/runtime/engine.py", line 1297, in _configure_optimizer
[rank5]:     raise ZeRORuntimeException(msg)
[rank5]: deepspeed.runtime.zero.utils.ZeRORuntimeException: You are using ZeRO-Offload with a client provided optimizer (<class 'torch.optim.adamw.AdamW'>) which in most cases will yield poor performance. Please either use deepspeed.ops.adam.DeepSpeedCPUAdam or set an optimizer in your ds-config (https://www.deepspeed.ai/docs/config-json/#optimizer-parameters). If you really want to use a custom optimizer w. ZeRO-Offload and understand the performance impacts you can also set <"zero_force_ds_cpu_optimizer": false> in your configuration file.
[rank0]: Traceback (most recent call last):
[rank0]:   File "/raid/chrisjihee/proj/DeepKNLP/task2-nerG.py", line 822, in <module>
[rank0]:     app()
[rank0]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 340, in __call__
[rank0]:     raise e
[rank0]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 323, in __call__
[rank0]:     return get_command(self)(*args, **kwargs)
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1157, in __call__
[rank0]:     return self.main(*args, **kwargs)
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/core.py", line 743, in main
[rank0]:     return _main(
[rank0]:            ^^^^^^
[rank0]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/core.py", line 198, in _main
[rank0]:     rv = self.invoke(ctx)
[rank0]:          ^^^^^^^^^^^^^^^^
[rank0]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1688, in invoke
[rank0]:     return _process_result(sub_ctx.command.invoke(sub_ctx))
[rank0]:                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 1434, in invoke
[rank0]:     return ctx.invoke(self.callback, **ctx.params)
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/click/core.py", line 783, in invoke
[rank0]:     return __callback(*args, **kwargs)
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/typer/main.py", line 698, in wrapper
[rank0]:     return callback(**use_params)
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/raid/chrisjihee/proj/DeepKNLP/task2-nerG.py", line 619, in train
[rank0]:     model_optimizer = fabric.setup(model, optimizer)
[rank0]:                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/fabric.py", line 245, in setup
[rank0]:     module, optimizers = self._strategy.setup_module_and_optimizers(  # type: ignore[assignment]
[rank0]:                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/strategies/deepspeed.py", line 331, in setup_module_and_optimizers
[rank0]:     self._deepspeed_engine, optimizer = self._initialize_engine(module, optimizers[0])
[rank0]:                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/lightning/fabric/strategies/deepspeed.py", line 607, in _initialize_engine
[rank0]:     deepspeed_engine, deepspeed_optimizer, _, _ = deepspeed.initialize(
[rank0]:                                                   ^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/__init__.py", line 193, in initialize
[rank0]:     engine = DeepSpeedEngine(args=args,
[rank0]:              ^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/runtime/engine.py", line 315, in __init__
[rank0]:     self._configure_optimizer(optimizer, model_parameters)
[rank0]:   File "/raid/chrisjihee/miniforge3/envs/DeepKNLP/lib/python3.11/site-packages/deepspeed/runtime/engine.py", line 1297, in _configure_optimizer
[rank0]:     raise ZeRORuntimeException(msg)
[rank0]: deepspeed.runtime.zero.utils.ZeRORuntimeException: You are using ZeRO-Offload with a client provided optimizer (<class 'torch.optim.adamw.AdamW'>) which in most cases will yield poor performance. Please either use deepspeed.ops.adam.DeepSpeedCPUAdam or set an optimizer in your ds-config (https://www.deepspeed.ai/docs/config-json/#optimizer-parameters). If you really want to use a custom optimizer w. ZeRO-Offload and understand the performance impacts you can also set <"zero_force_ds_cpu_optimizer": false> in your configuration file.
[rank0]:[W1218 15:56:44.753995685 ProcessGroupNCCL.cpp:1250] Warning: WARNING: process group has NOT been destroyed before we destruct ProcessGroupNCCL. On normal program exit, the application should call destroy_process_group to ensure that any pending NCCL operations have finished in this process. In rare cases this process can exit before this point and block the progress of another member of the process group. This constraint has always been present,  but this warning has only been added since PyTorch 2.4 (function operator())

Process finished with exit code 1
